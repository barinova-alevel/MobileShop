FROM node:alpine as build-stage
WORKDIR /app
COPY Web/SPA/package*.json /app
RUN npm install
COPY Web/SPA/ /app

ARG REACT_APP_AUTH_URL
ARG REACT_APP_IDENTITY_CLIENT_ID
ARG REACT_APP_IDENTITY_CLIENT_SECRET
ARG REACT_APP_REDIRECT_URL
ARG REACT_APP_SILENT_REDIRECT_URL
ARG REACT_APP_LOGOFF_REDIRECT_URL
ARG REACT_APP_BASE_API_URL
ARG REACT_APP_ROUTE_CATALOG
ARG REACT_APP_ROUTE_BASKET

ENV REACT_APP_AUTH_URL=${REACT_APP_AUTH_URL}
ENV REACT_APP_IDENTITY_CLIENT_ID=${REACT_APP_IDENTITY_CLIENT_ID}
ENV REACT_APP_IDENTITY_CLIENT_SECRET=${REACT_APP_IDENTITY_CLIENT_SECRET}
ENV REACT_APP_REDIRECT_URL=${REACT_APP_REDIRECT_URL}
ENV REACT_APP_SILENT_REDIRECT_URL=${REACT_APP_SILENT_REDIRECT_URL}
ENV REACT_APP_LOGOFF_REDIRECT_URL=${REACT_APP_LOGOFF_REDIRECT_URL}
ENV REACT_APP_BASE_API_URL=${REACT_APP_BASE_API_URL}
ENV REACT_APP_ROUTE_CATALOG=${REACT_APP_ROUTE_CATALOG}
ENV REACT_APP_ROUTE_BASKET=${REACT_APP_ROUTE_BASKET}

RUN npm run build

FROM nginx:alpine
WORKDIR /var/www/
RUN rm -rf ./*
COPY --from=build-stage /app/build .