FROM node:alpine as build-stage
WORKDIR /app
COPY Web/SPA/package*.json /app
RUN npm install
COPY Web/SPA/ /app

ARG REACT_APP_AUTH_URL
ARG REACT_APP_IDENTITY_CLIENT_ID
ARG REACT_APP_IDENTITY_CLIENT_SECRET
ARG REACT_APP_BASE_API_URL

ENV REACT_APP_AUTH_URL=${REACT_APP_AUTH_URL}
ENV REACT_APP_IDENTITY_CLIENT_ID=${REACT_APP_IDENTITY_CLIENT_ID}
ENV REACT_APP_IDENTITY_CLIENT_SECRET=${REACT_APP_IDENTITY_CLIENT_SECRET}
ENV REACT_APP_BASE_API_URL=${REACT_APP_BASE_API_URL}

RUN npm run build

FROM nginx:alpine
WORKDIR /var/www/
RUN rm -rf ./*
COPY --from=build-stage /app/build .